# CI/CD
> Continuous Intergration, Continuous Deployment
> Ïö∞Î¶¨Í∞Ä ÏΩîÎìúÎ•º ÍπÉÏóê Ìë∏Ïãú ÌíÄ Î∞õÏïÑÏÑú ÏÑúÎ≤Ñ ÎåÄÍ∏∞ÏÉÅÌÉú
> ÏâΩÍ≤å ÎßêÌï¥ÏÑú ÌÖåÏä§Ìä∏(test), ÌÜµÌï©(merge), Î∞∞Ìè¨(Deploy)Î•º ÏûêÎèôÌôî

## CI/CD Í≥ºÏ†ï
ÏûëÏóÖÏûê > Ïª§Î∞ã, Ìë∏Ïâ¨ > ÎπåÎìú ÌÖåÏä§Ìä∏ > Î∞∞Ìè¨

## ÏÑúÎπÑÏä§Î•º Ïö¥ÏòÅ
> ÏÑúÎπÑÏä§Î•º Ïö¥ÏòÅ Î∞∞Ìè¨ ÌïòÎã§Î≥¥Î©¥
> Í∏∞Îä•Ïù¥ Î≤àÎ≤àÌûà ÏÉàÎ°úÏö¥ Í∏∞Îä•Ïù¥ Ï∂îÍ∞ÄÎêòÎäîÎç∞ ÏóÖÎç∞Ïù¥Ìä∏Í∞Ä ÎêòÎäîÎç∞
> Ïö∞Î¶¨Í∞Ä ÏÉàÎ°ú ÏûëÏÑ±ÌïòÎäî ÏΩîÎìúÎ•º Ïª§Î∞ã Ìë∏Ïãú ÌíÄ Î∏åÎü∞ÏπòÏóêÏÑú Î≥ëÌï©ÌïòÍ≥† aws Í∞ÄÏÉÅÏÑúÎ≤ÑÏóê
> ÏΩîÎìúÎÇ¥Ïö©ÏùÑ Î∞õÍ≥† ÏâòÎ°ú Îã§Ïãú Ïã§ÌñâÌïòÍ≥† ÌïòÎ©¥ ÏÉùÍ∞ÅÎ≥¥Îã§ Í∑ÄÏ∞ÆÏùå

## ÏûêÎèôÌôî
> Í∑∏ÎûòÏÑú ÏúÑÏùò Í≥ºÏ†ïÏù¥ ÎÑàÎ¨¥ Î≤àÍ±∞Î°≠Í∏∞ ÎïåÎ¨∏Ïóê Ïù¥Îü∞ Î∞òÎ≥µÎêòÎäî Í≤É Í≥ºÏ†ïÏùÑ ÏûêÎèôÌôî ÏãúÌÇ®Í≤É

## github-Actions
> Ïö∞Î¶¨Îäî CI/CD ÌôòÍ≤Ω Íµ¨Ï∂ïÏùÑ ÎπåÎìú ÏÑúÎ≤ÑÎèÑ Ï†úÍ≥µÌï¥Ï£ºÍ≥† Î¨¥Î£åÏù∏ github-Actions
- Ïû•Ï†ê
  1. ÎπåÎìúÏö© ÏÑúÎ≤ÑÍ∞Ä Îî∞Î°ú ÌïÑÏöî ÏóÜÏùå(ÎπåÎìú ÏÑúÎ≤Ñ ÏÑ∏ÌåÖÏúºÎ°ú ÏãúÍ¥ÄÍ≥º ÎèàÏùÑ Ïì∏ ÌïÑÏöîÍ∞Ä ÏóÜÎã§.) Ïö∞Î∂ÑÌà¨ ÌôòÍ≤ΩÏùÑ Ï†úÍ≥µÌï¥Ï§å Ïù∏Ïä§ÌÑ¥Ïä§ÏóêÏÑú ÎπåÎìúÎ•º Ìï†Îïå Î©îÎ™®Î¶¨Í∞Ä Î∂ÄÏ°±Ìïú Î¨∏Ï†úÎèÑ ÎπåÎìúÎ•º Ìï¥ÏÑú ÎπåÎìúÌååÏùºÏùÑ Ïò¨Î¶¨Í≤å ÎêòÎ©¥ Î©îÎ™®Î¶¨Î•º Ï†àÏïΩÌï†Ïàò ÏûàÎã§. Ï¶â ÎèàÏùÑ Ï†àÏïΩ
  2. githubÏôÄ ÌÜµÏùºÎêú ÌôòÍ≤ΩÏóêÏÑú CIÍ∞Ä ÏàòÌñâÏù¥ Í∞ÄÎä•ÌïòÎã§.
  3. Yaml ÌååÏùºÏùÑ Ïù¥Ïö©Ìï¥ÏÑú Í∞ÑÎã®ÌïòÍ≤å Î°úÏßÅÏùÑ ÏûëÏÑ±Ìï†Ïàò ÏûàÎã§. runner Í∞ÄÏÉÅ Î®∏Ïã† 
  4. Yaml ÌååÏùºÎ°ú Í∞ÑÎã®Ìïú ÌååÏù¥ÌîÑÎùºÏù∏ Íµ¨ÏÑ± 
  > `ÌååÏù¥ÌîÑ ÎùºÏù∏` : ÏûëÏóÖÎì§ÏùÑ ÏàúÏ∞®Ï†ÅÏúºÎ°ú ÏàòÌñâÌïòÎäîÍ≤É
  > ÏÜåÌîÑÌä∏Ïõ®Ïñ¥ Í∞úÎ∞úÏóêÏÑú ÏΩîÎìúÎ•º ÎπåÎìúÌïòÍ≥† ÌÖåÏä§Ìä∏ÌïòÍ≥† Î∞∞Ìè¨ÌïòÎäî Îã®Í≥ÑÎ•º ÏûêÎèôÌôîÌïú ÌùêÎ¶Ñ

CI/CDÏùò ÌååÏù¥ÌîÑ ÎùºÏù∏ÏùÄ ÏûëÏóÖÏùÑ ÏûêÎèôÌôîÌïòÍ≥† Í∞úÎ∞úÏùò ÏÜçÎèÑ Ï¶ùÏßÑ Î∞è ÌíàÏßàÏù¥ Ï¢ãÎã§.
1. ÏΩîÎìú Ïª§Î∞ã, Ìë∏Ïâ¨
2. Ìë∏Ïâ¨ Ïù¥Î≤§Ìä∏Î•º Î≥¥Í≥† CI ÏÑúÎ≤Ñ Ìä∏Î¶¨Í±∞ Ìò∏Ï∂ú
3. ÏΩîÎìú ÎπåÎìú
4. ÏûêÎèôÌôî ÌÖåÏä§Ìä∏ Ïã§Ìñâ
5. Î∞∞Ìè¨ Ï§ÄÎπÑ
6. Î∞∞Ìè¨
7. Î™®ÎãàÌÑ∞ÎßÅ

## github actionsÏùò Í∞ÄÏÉÅ Î®∏Ïã† Íµ¨Ï°∞
> ÏΩîÎìú Ïª§Î∞ã, Ìë∏Ïâ¨ -> Ìë∏Ïâ¨ Ïù¥Î≤§Ìä∏Î•º github actionsÍ∞Ä Í∞êÏßÄÌïòÍ≥† CI/CD Î°úÏßÅ Ïã§Ìñâ -> Î∞∞Ìè¨(aws)

> Ïù¥Îü∞ ÎπåÎìú ÌÖåÏä§Ìä∏ Î∞∞Ìè¨ ÏûëÏóÖÏùÑ github actionsÎäî Îü¨ÎÑà ÎùºÍ≥† Î∂ÄÎ•¥Îäî Í∞ÄÏÉÅ Î®∏Ïã†Ïù¥ Ïª®ÌÖåÏù¥ÎÑàÏóêÏÑú Ïã§ÌñâÎêúÎã§.
> github actionsÏùò Îü¨ÎÑàÎäî Î≥ÑÎèÑÏúº „Ö£ÏÑúÎ≤Ñ ÏóÜÏù¥ ÏûêÎèôÌôî ÏûëÏóÖÏùÑ Ï†úÍ≥µÌïúÎã§.
> Îü¨ÎÑàÎäî ÏÇ¨Ïö©ÏûêÍ∞Ä ÏõêÌïòÎäî Ïö¥ÏòÅÏ≤¥Ï†úÎ•º Ï†úÍ≥µÌïúÎã§. ÏúàÎèÑÏö∞ Îß•os Î¶¨ÎàÖÏä§ Ïö∞Î∂ÑÌà¨ Îì±
> `ÏûêÎèô Ïä§ÏºÄÏùºÎßÅ` ÏúºÎ°ú Î¶¨ÏÜåÏä§Î•º Ìö®Ïú®Ï†ÅÏúºÎ°ú ÏÇ¨Ïö©Ìï†Ïàò ÏûàÎã§.
> nodejsm python, java Îì±Ïùò Îü∞ÌÉÄÏûÑ ÌôòÍ≤ΩÏù¥ ÏÑ§ÏπòÎêòÏñ¥ ÏûàÎã§ Îπ†Î•¥Í≤å ÎπåÎìú ÌÖåÏä§Ìä∏Í∞Ä Í∞ÄÎä•ÌïòÎã§

`ÏûêÎèô Ïä§ÏºÄÏùºÎßÅ`ÏùÄ ÌÅ¥ÎùºÏö∞Îìú Ïª¥Ìì®ÌåÖ ÌôòÍ≤ΩÏóêÏÑú ÏÇ¨Ïö©ÎêòÎäî Í∏∞Ïà† Ïª¥Ìì®ÌåÖ ÏûêÏõêÏùò ÏñëÏùÑ ÏûêÎèôÏúºÎ°ú Ï°∞Ï†ïÌï†Ïàò ÏûàÎã§Îäî Í≤ÉÏùÑ ÏùòÎØ∏

## Ìè¥Îçî Íµ¨Ï°∞
> ÍπÉÏùò ÏõêÍ≤Ω Ïª§Î∞ãÍ≥º Ìë∏Ïâ¨Î•º Ìï†Îïå
.github
- workflows
-- yml ÌååÏùºÏùÑ ÌïòÎÇò ÎßåÎì§Ïñ¥ÏïºÌïúÎã§

## github actions ÏÇ¨Ïö©
```yml
name: GitHub Actions Demo
run-name: ${{ github.actor }} is testing out GitHub Actions üöÄ
on: [push]
jobs:
  Explore-GitHub-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo "üéâ The job was automatically triggered by a ${{ github.event_name }} event."
      - run: echo "üêß This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "üîé The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v4
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - run: echo "üñ•Ô∏è The workflow is now ready to test your code on the runner."
      - name: List files in the repository
        run: |
          ls ${{ github.workspace }}
      - run: echo "üçè This job's status is ${{ job.status }}."

```

## aws ec2Ïóê Ïâò Ïä§ÌÅ¨Î¶ΩÌä∏Î•º Ïã§Ìñâ
> ec2Ïóê ssh Ïª§ÎÑ•ÏÖòÏùÑ Îß∫Í≥† Ïâ° Ïä§ÌÅ¨Î¶ΩÌä∏ Ïã§Ìñâ
```yml
name: CI/CD Íµ¨Ï∂ï

on:
  push:
    branches:
      - main

jobs:
  Deploy:
    runs-on: ubuntu-lastest
    steps:
      - name: checkout
        uses: actions/checkout@v4 # uses ÏÇ¨Ïö©Ìï† ÎùºÏù¥Î∏åÎü¨Î¶¨

      - name: ssh key
        uses: webfactory/ssh-agent@v0.5.3
        with: # ÏûëÏÑ±Ìï† ÏÜçÏÑ±ÏùÑ Ï†ïÏùò
          ssh-private-key: ${{ secrets.AWS_SECRET_KEY }}

      - name: ssh ec2 Ï†ëÏÜç
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.AWS_SECRET_KEY }}
          port: ${{ secrets.PORT }}
          script: | # Ïã§ÌñâÌï† Ïä§ÌÅ¨Î¶ΩÌä∏
            cd /home/ubuntu/study
            npm start

```

## Ï∞ê ÏµúÏ¢Ö nestjs ÎπåÎìúÌï¥ÏÑú ÎπåÎìú ÌååÏùº Ïò¨Î¶¨Í≥† Î¨¥Ï§ëÎã® Î∞∞Ìè¨
```yml
name: last nest deploy

on:
  push:
    branches:
      - main
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: checkout
        use: actions/checkout@v4
    
      - name: set up node
        use: actions/setup-node@v4

      - name: create .env
        run: |
          "${{ secrets.MY_KEY }}" > .env

      - name: nam install # ÏùòÏ°¥ÏÑ± ÏÑ§Ïπò npm audit fix || true Î≥¥Ïïà Ï∑®ÏïΩÏ†êÏùÑ ÏûêÎèôÏúºÎ°ú Ïú†Ïó∞ÌïòÍ≤å ÏàòÏ†ïÌï¥ÏÑú Ïã§Ìå®Ìï¥ÎèÑ ÏùºÎã® ÎπåÎìú ÏßÑÌñâÌïòÎ©¥ÏÑú ÏùòÏ°¥ÏÑ± Ïú†Ïó∞ÌïòÍ≤å ÏÑ§Ïπò
        run: |
          npm install
          npm audit fix || true

      - name: build nestjs
        run: |
          source .env
          npm run build

      - name: build output # ls -la dist distÌè¥Îçî ÏïàÏùò ÎÇ¥ÏöîÏùÑ ÏÉÅÏÑ∏ÌïòÍ≤å Ï∂úÎ†• pwd ÌòÑÏû¨ ÏûëÏóÖ Í≤ΩÎ°ú Ï∂úÎ†•
        run: |
          ls -al dist
          pwd

      - name: Upload build artifacts # ÎπåÎìú Ï§ÄÎπÑ Îã®Í≥Ñ ÏóÖÎ°úÎìú ÌïòÍ∏∞Ï†Ñ Îã®Í≥Ñ
        uses: actions/upload-artifact@v4
        with:
          name: build-artifacts
          path: dist/

      - name: ssh key
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.AWS_SECRET_KEY }}" > ~/.ssh/aws_key
          chmod 600 ~/.ssh/aws_key
          ssh-keyscan -H ${{ secrets.HOST }} >> ~/.ssh/known_hosts
          cat ~/.ssh/known_hosts

      - name: debug artifacts
        run: |
          ls -al .dist
    
      - name: ec2 deploy
        uses: appleboy/ssh-action@v1.0.3
        with: 
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.AWS_SECRET_KEY }}
          port: ${{ secrets.PORT }}
          script: | # Ïã§ÌñâÌï† Ïä§ÌÅ¨Î¶ΩÌä∏
            cd ~/study
            rm -rf dist
            mkdir dist
    
      - name: ec2 artifacts copy
        run: |
          scp -r -i ~/.ssh/aws_key ./dist/* ${{ secrets.USERNAME }}@${{ secrets.HOST }}:/home/ubuntu/study/dist/

      - name: deploy to ec2
        uses: appleboy/ssh-action@v1.0.3
        with: 
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.AWS_SECRET_KEY }}
          port: ${{ secrets.PORT }}
          script: |
            cd ~/study
            pm2 reload system.config.js --env production
            

```